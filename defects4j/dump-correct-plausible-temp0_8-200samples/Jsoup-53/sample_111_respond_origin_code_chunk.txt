    public String chompBalanced(char open, char close) {
        StringBuilder accum = new StringBuilder();
        int depth = 0;
        char last = 0;
        char ch = 0;
        while (depth >= 0 && !isEmpty()) {
            if (isEmpty()) break;
            ch = consume();
            if (last == 0 || last != ESC) {
                if (ch == open) {
                    depth++;
                }
                else if (ch == close)
                    depth--;
            }
            if (depth > 0 && last != 0) accum.append(ch);
            last = ch;
        }
        if (depth < 0) {
            // unread the last character
            pos -= 1;
        }
        return accum.toString();
    }


 

