public class Caverphone {
    public static String encode(String text) {
        if (text == null || text.length() == 0) {
            return "111111";
        }
        text = text.toLowerCase(Locale.ENGLISH);
        text = text.replaceAll("[^a-z]", "");
        StringBuffer result = new StringBuffer(text.length());
        result.append(text.charAt(0));
        for (int i = 1; i < text.length(); i++) {
            String previousCharacter = text.substring(i - 1, i);
            String currentCharacter = text.substring(i, i + 1);
            if (currentCharacter.equals(previousCharacter)) {
                if (result.charAt(result.length() - 1) != '2') {
                    result.append('2');
                }
            } else if (currentCharacter.equals("c")
                    && "eiy".contains(previousCharacter)) {
                result.append('s');
            } else if (currentCharacter.equals("g")
                    && "eiy".contains(previousCharacter)) {
                result.append('j');
            } else if ("aeiou".contains(currentCharacter)) {
                result.append('3');
            } else if ("bgp".contains(currentCharacter)) {
                result.append('1');
            } else if ("dtk".contains(currentCharacter)) {
                result.append('2');
            } else if (currentCharacter.equals("h")) {
                if (!result.toString().endsWith("1")
                        && !"cgjrsvz".contains(previousCharacter)) {
                    result.append('2');
                }
            } else if (currentCharacter.equals("l")) {
                result.append('4');
            } else if (currentCharacter.equals("m")) {
                result.append('5');
            } else if (currentCharacter.equals("n")) {
                result.append('6');
            } else if ("r".equals(currentCharacter)) {
                result.append('7');
            } else if ("fhw".contains(currentCharacter)) {
                result.append('8');
            } else if ("ckq".contains(currentCharacter)) {
                result.append('9');
            } else if (currentCharacter.equals("s")) {
                result.append('s');
            } else if (currentCharacter.equals("z")) {
                result.append('s');
            } else if (currentCharacter.equals("x")) {
                result.append('s');
            } else if (currentCharacter.equals("v")) {
                result.append('f');
            } else {
                result.append(currentCharacter);
            }
        }
        return result.toString().replaceAll("(.)\\1+", "$1");
    }
    public static void main(String[] args) {
        System.out.println(encode("The quick brown fox"));
        System.out.println(encode("The quick brown fox".toUpperCase()));
        System.out.println(encode("The quick brown fox".toUpperCase(Locale.GERMAN)));
    }
}