  void add(String newcode) {
    maybeEndStatement();

    if (newcode.length() == 0) {
      return;
    }

    char c = newcode.charAt(0);
    if (shouldAddSpaceBefore(c)) {
      // need space to separate. This is not pretty printing.
      // For example: "return foo;"
      append(" ");
      // Do not allow a forward slash to appear after a DIV.
      // For example,
      // REGEXP DIV REGEXP
      // is valid and should print like
      // / // / /
    }

    append(newcode);
  }
  private boolean shouldAddSpaceBefore(char c) {
    // TODO(johnlenz): re-add the isWordChar(c) guard once
    // newlines are being preserved.
    return (isWordChar(c) || c == '\\') &&
        isWordChar(getLastChar()) &&
        (c != '/' || getLastChar() != '/');
  }
