public void withPattern(final String pattern) {
    int sz = pattern.length();

    char opt = ' ';
    char ch = ' ';
    char type = ' ';
    boolean required = false;

    boolean isOption = false;
    boolean isOptionSet = false;

    for (int i = 0; i < sz; i++) {
        ch = pattern.charAt(i);

        switch (ch) {
            case '!' :
                if (isOption) {
                    createOption(type, required, opt);
                    required = false;
                    type = ' ';
                    opt = ' ';
                }
                isOption = true;
                isOptionSet = true;
                required = true;
                break;
            case '@' :
            case ':' :
            case '%' :
            case '+' :
            case '#' :
            case '<' :
            case '>' :
            case '*' :
            case '/' :
                if (isOption) {
                    createOption(type, required, opt);
                    required = false;
                    type = ' ';
                    opt = ' ';
                }
                isOption = true;
                isOptionSet = true;
                type = ch;
                break;
            case '|' :
                if (isOption) {
                    createOption(type, required, opt);
                    required = false;
                    type = ' ';
                    opt = ' ';
                }
                isOption = true;
                isOptionSet = false;
                break;
            default :
                if (isOptionSet) {
                    if (opt != ' ') {
                        createOption(type, required, opt);
                        required = false;
                        type = ' ';
                    }

                    opt = ch;
                }
        }
    }

    if (isOptionSet && opt != ' ') {
        createOption(type, required, opt);
    }
}

